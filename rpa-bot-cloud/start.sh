
#!/bin/bash
# ÐŸÑ€Ð¾Ð´Ð²Ð¸Ð½ÑƒÑ‚Ñ‹Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð´Ð»Ñ Railway

echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ñ€Ð¾Ð´Ð²Ð¸Ð½ÑƒÑ‚Ð¾Ð³Ð¾ Cloud RPA Bot Ð½Ð° Railway..."

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
if [ -z "$SUPABASE_URL" ]; then
    echo "âŒ ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ SUPABASE_URL Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð°"
    exit 1
fi

if [ -z "$SUPABASE_SERVICE_KEY" ]; then
    echo "âš ï¸  ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ SUPABASE_SERVICE_KEY Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð°"
    echo "Ð‘Ð¾Ñ‚ Ð±ÑƒÐ´ÐµÑ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð±ÐµÐ· Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð² Ð² Supabase"
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
if [ -n "$ANTICAPTCHA_KEY" ]; then
    echo "âœ… AntiCaptcha ÐºÐ»ÑŽÑ‡ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½"
else
    echo "âš ï¸  AntiCaptcha ÐºÐ»ÑŽÑ‡ Ð½Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½ - Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ ÐºÐ°Ð¿Ñ‡Ð¸ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾"
fi

# Ð—Ð°Ð¿ÑƒÑÐº Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð´Ð¸ÑÐ¿Ð»ÐµÑ
echo "ðŸ–¥ï¸  Ð—Ð°Ð¿ÑƒÑÐº Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð´Ð¸ÑÐ¿Ð»ÐµÑ..."
Xvfb :99 -screen 0 1920x1080x24 -ac +extension GLX +render -noreset &
export DISPLAY=:99

# Ð—Ð°Ð¿ÑƒÑÐº window manager Ð´Ð»Ñ GUI Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¹
echo "ðŸªŸ Ð—Ð°Ð¿ÑƒÑÐº window manager..."
fluxbox &

# ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸ Ð´Ð¸ÑÐ¿Ð»ÐµÑ
sleep 5

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Chrome
echo "ðŸŒ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Google Chrome..."
if google-chrome --version; then
    echo "âœ… Chrome ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾"
    CHROME_VERSION=$(google-chrome --version)
    echo "   Ð’ÐµÑ€ÑÐ¸Ñ: $CHROME_VERSION"
else
    echo "âŒ Chrome Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
    exit 1
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Python Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
echo "ðŸ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Python Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹..."
python -c "import selenium, undetected_chromedriver, fake_useragent" || {
    echo "âŒ ÐÐµ Ð²ÑÐµ Python Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹"
    exit 1
}

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ñ… Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¹
echo "ðŸ“ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¹..."
mkdir -p screenshots logs profiles extensions

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿Ñ€Ð°Ð² Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°
chmod +x rpa_bot_cloud.py

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ñ… Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²
echo "ðŸ’¾ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ñ… Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²..."
echo "   ÐŸÐ°Ð¼ÑÑ‚ÑŒ: $(free -h | grep '^Mem:' | awk '{print $3 "/" $2}')"
echo "   Ð”Ð¸ÑÐº: $(df -h / | tail -1 | awk '{print $3 "/" $2 " (" $5 " Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ)"}')"

echo "âœ… Ð’ÑÐµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹ Ð³Ð¾Ñ‚Ð¾Ð²Ñ‹ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð²Ð¸Ð½ÑƒÑ‚Ð¾Ð³Ð¾ Ñ€ÐµÐ¶Ð¸Ð¼Ð°"
echo "ðŸ¤– Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ñ€Ð¾Ð´Ð²Ð¸Ð½ÑƒÑ‚Ð¾Ð³Ð¾ RPA Bot..."
echo "ðŸ”§ Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸: ÐÐ½Ñ‚Ð¸Ð´ÐµÑ‚ÐµÐºÑ‚, Ð¡Ñ‚ÐµÐ»Ñ-Ñ€ÐµÐ¶Ð¸Ð¼, Ð ÐµÑˆÐµÐ½Ð¸Ðµ ÐºÐ°Ð¿Ñ‡Ð¸, Ð§ÐµÐ»Ð¾Ð²ÐµÑ‡ÐµÑÐºÐ¾Ðµ Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ"

# Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ñ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ñ‹Ð¼ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼
python rpa_bot_cloud.py 2>&1 | tee logs/bot_output.log
